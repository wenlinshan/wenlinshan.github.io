<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>ClickHouse 数组的相关操作函数，一网打尽(十) | 热心市民温温</title><meta name="author" content="wenwen"><meta name="copyright" content="wenwen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ClickHouse 数组的相关操作函数，一网打尽​																	本文来源： ( https:&#x2F;&#x2F;www.cnblogs.com&#x2F;traditional&#x2F;tag&#x2F;ClickHouse：一款速度快到让人发指的列式存储数据库&#x2F; )   楔子在一般的关系型数据库，相信很多人都不怎么使用数组这个结构，如果真的需要数组，那么会选择将其变成数组格式的字符串进行存储。但在 ClickHous">
<meta property="og:type" content="article">
<meta property="og:title" content="ClickHouse 数组的相关操作函数，一网打尽(十)">
<meta property="og:url" content="https://hesay.cn/2023/04/11/ClickHouse%20%E6%95%B0%E7%BB%84%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD(%E5%8D%81)/index.html">
<meta property="og:site_name" content="热心市民温温">
<meta property="og:description" content="ClickHouse 数组的相关操作函数，一网打尽​																	本文来源： ( https:&#x2F;&#x2F;www.cnblogs.com&#x2F;traditional&#x2F;tag&#x2F;ClickHouse：一款速度快到让人发指的列式存储数据库&#x2F; )   楔子在一般的关系型数据库，相信很多人都不怎么使用数组这个结构，如果真的需要数组，那么会选择将其变成数组格式的字符串进行存储。但在 ClickHous">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hesay.cn/img/favicon.png">
<meta property="article:published_time" content="2023-04-11T09:04:31.000Z">
<meta property="article:modified_time" content="2023-04-13T09:06:57.974Z">
<meta property="article:author" content="wenwen">
<meta property="article:tag" content="ClickHouse">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hesay.cn/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://hesay.cn/2023/04/11/ClickHouse%20%E6%95%B0%E7%BB%84%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD(%E5%8D%81)/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ClickHouse 数组的相关操作函数，一网打尽(十)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-13 17:06:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="热心市民温温"><span class="site-name">热心市民温温</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">ClickHouse 数组的相关操作函数，一网打尽(十)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-11T09:04:31.000Z" title="发表于 2023-04-11 17:04:31">2023-04-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-13T09:06:57.974Z" title="更新于 2023-04-13 17:06:57">2023-04-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ClickHouse/">ClickHouse</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ClickHouse 数组的相关操作函数，一网打尽(十)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="ClickHouse-数组的相关操作函数，一网打尽"><a href="#ClickHouse-数组的相关操作函数，一网打尽" class="headerlink" title="ClickHouse 数组的相关操作函数，一网打尽"></a>ClickHouse 数组的相关操作函数，一网打尽</h1><p>​																	本文来源： ( <a target="_blank" rel="noopener" href="https://www.cnblogs.com/traditional/tag/ClickHouse%EF%BC%9A%E4%B8%80%E6%AC%BE%E9%80%9F%E5%BA%A6%E5%BF%AB%E5%88%B0%E8%AE%A9%E4%BA%BA%E5%8F%91%E6%8C%87%E7%9A%84%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E5%BA%93/">https://www.cnblogs.com/traditional/tag/ClickHouse：一款速度快到让人发指的列式存储数据库/</a> ) </p>
<hr>
<h3 id="楔子"><a href="#楔子" class="headerlink" title="楔子"></a>楔子</h3><p><strong>在一般的关系型数据库，相信很多人都不怎么使用数组这个结构，如果真的需要数组，那么会选择将其变成数组格式的字符串进行存储。但在 ClickHouse 中，数组的使用频率是非常高的，因为它内置了大量和数组有关的函数。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> version();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─version()─┐</span></span><br><span class="line"><span class="comment">│ 21.7.3.14 │</span></span><br><span class="line"><span class="comment">└───────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>() <span class="keyword">FROM</span> system.functions <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%array%&#x27;</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─count()─┐</span></span><br><span class="line"><span class="comment">│      48 │</span></span><br><span class="line"><span class="comment">└─────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>当前的 ClickHouse 是 21.7.3.14 版本，关于数组的函数有 48 个，通过这个 48 个函数，我们可以对数组进行各种骚操作。当然也有一些函数不是专门针对数组的，但是可以用在数组身上，我们就也放在一起说了，下面就来依次介绍相关函数的用法。</strong></p>
<p><strong>empty：判断数组是否为空，如果一个数组不包含任何元素，返回 1；否则返回 0</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">empty</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]), <span class="keyword">empty</span>([]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─empty([1, 2, 3])─┬─empty(array())─┐</span></span><br><span class="line"><span class="comment">│                0 │              1 │</span></span><br><span class="line"><span class="comment">└──────────────────┴────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>empty 不仅可以检测数组是否为空，还可以检测字符串。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">empty</span>(<span class="string">&#x27;satori&#x27;</span>), <span class="keyword">empty</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─empty(&#x27;satori&#x27;)─┬─empty(&#x27;&#x27;)─┐</span></span><br><span class="line"><span class="comment">│               0 │         1 │</span></span><br><span class="line"><span class="comment">└─────────────────┴───────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>notEmpty：判断数组是否不为空，如果一个数组包含至少一个元素，返回 1；不包含任何元素，则返回 0</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> notEmpty([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]), notEmpty([]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─notEmpty([1, 2, 3])─┬─notEmpty(array())─┐</span></span><br><span class="line"><span class="comment">│                   1 │                 0 │</span></span><br><span class="line"><span class="comment">└─────────────────────┴───────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 同样可以作用于字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> notEmpty(<span class="string">&#x27;satori&#x27;</span>), notEmpty(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─notEmpty(&#x27;satori&#x27;)─┬─notEmpty(&#x27;&#x27;)─┐</span></span><br><span class="line"><span class="comment">│                  1 │            0 │</span></span><br><span class="line"><span class="comment">└────────────────────┴──────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>length：返回数组的长度，该函数也可以返回字符串的长度</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> length([]), length([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]), length(<span class="string">&#x27;satori&#x27;</span>), length(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─length(array())─┬─length([1, 2, 3])─┬─length(&#x27;satori&#x27;)─┬─length(&#x27;&#x27;)─┐</span></span><br><span class="line"><span class="comment">│               0 │                 3 │                6 │          0 │</span></span><br><span class="line"><span class="comment">└─────────────────┴───────────────────┴──────────────────┴────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>emptyArrayUInt8、emptyArrayUInt16、emptyArrayUInt32、emptyArrayUInt64、emptyArrayInt8、emptyArrayInt16、emptyArrayInt32、emptyArrayInt64、emptyArrayFloat32、emptyArrayFloat64、emptyArrayDate、emptyArrayDateTime、emptyArrayString：创建一个指定类型的空数组</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 数组元素的类型为 nothing，因为没有指定任何元素</span></span><br><span class="line"><span class="keyword">SELECT</span> [] v, toTypeName(v);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v──┬─toTypeName(array())─┐</span></span><br><span class="line"><span class="comment">│ [] │ Array(Nothing)      │</span></span><br><span class="line"><span class="comment">└────┴─────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 采用最小类型存储，因为 1 和 2 都在 UInt8 的范围内</span></span><br><span class="line"><span class="keyword">SELECT</span> [<span class="number">1</span>, <span class="number">2</span>] v, toTypeName(v);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v─────┬─toTypeName([1, 2])─┐</span></span><br><span class="line"><span class="comment">│ [1,2] │ Array(UInt8)       │</span></span><br><span class="line"><span class="comment">└───────┴────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 但是我们可以创建指定类型的数组</span></span><br><span class="line"><span class="keyword">SELECT</span> emptyArrayDateTime() v, toTypeName(v);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v──┬─toTypeName(emptyArrayDateTime())─┐</span></span><br><span class="line"><span class="comment">│ [] │ Array(DateTime)                  │</span></span><br><span class="line"><span class="comment">└────┴──────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>range：类似于 Python 中的 range，看测试用例</strong></p>
<p><img src="/2023/04/11/ClickHouse%20%E6%95%B0%E7%BB%84%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD(%E5%8D%81)/1229382-20210904151126780-1273074293.png" alt="img"></p>
<p><strong>array：也是创建一个数组，和直接使用方括号类似。但是 array 函数要求必须至少传递一个常量，否则就不知道要创建哪种类型的数组。如果想创建指定类型的空数组，那么使用上面的 emptyArray* 系列函数即可</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不管是使用 array 创建，还是使用 [] 创建，里面的元素都必须具有相同的类型，或者能够兼容</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─array(1, 2, 3)─┬─[1, 2, 3]─┐</span></span><br><span class="line"><span class="comment">│ [1,2,3]        │ [1,2,3]   │</span></span><br><span class="line"><span class="comment">└────────────────┴───────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayConat：将多个数组进行合并，得到一个新的数组</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SELECT 中起的别名可以被直接其它字段所使用</span></span><br><span class="line"><span class="keyword">SELECT</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] v1, [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>] v2, [<span class="number">111</span>, <span class="number">222</span>, <span class="number">333</span>] v3, arrayConcat(v1, v2, v3);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v1────┬─v2──────┬─v3────────┬─arrayConcat([1, 2], [11, 22], [111, 222])─┐</span></span><br><span class="line"><span class="comment">│ [1,2] │ [11,22] │ [111,222] │ [1,2,11,22,111,222]                       │</span></span><br><span class="line"><span class="comment">└───────┴─────────┴───────────┴───────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayElement：查找指定索引的元素，索引从 1 开始，也可以通过方括号直接取值；另外也支持负数索引，-1 代表最后一个元素</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 索引从 1 开始，所以 arr[20] 就表示第 20 个元素，也就是 19</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">range</span>(<span class="number">100</span>) <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> arrayElement(arr, <span class="number">20</span>), arr[<span class="number">20</span>];</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayElement(arr, 20)─┬─arrayElement(arr, 20)─┐</span></span><br><span class="line"><span class="comment">│                    19 │                    19 │</span></span><br><span class="line"><span class="comment">└───────────────────────┴───────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">range</span>(<span class="number">100</span>) <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> arrayElement(arr, <span class="number">-1</span>), arr[<span class="number">-50</span>];</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayElement(arr, -1)─┬─arrayElement(arr, -50)─┐</span></span><br><span class="line"><span class="comment">│                    99 │                     50 │</span></span><br><span class="line"><span class="comment">└───────────────────────┴────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>has：判断数组里面是否包含某个元素，如果包含，返回 1；不包含，返回0</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="keyword">Null</span>] <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> has(arr, <span class="number">2</span>), has(arr, <span class="number">0</span>), has(arr, <span class="keyword">Null</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─has(arr, 2)─┬─has(arr, 0)─┬─has(arr, NULL)─┐</span></span><br><span class="line"><span class="comment">│           1 │           0 │              1 │</span></span><br><span class="line"><span class="comment">└─────────────┴─────────────┴────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 嵌套数组也是可以的</span></span><br><span class="line"><span class="keyword">SELECT</span> has([[<span class="number">1</span>, <span class="number">2</span>]], [<span class="number">1</span>, <span class="number">2</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─has([[1, 2]], [1, 2])─┐</span></span><br><span class="line"><span class="comment">│                     1 │</span></span><br><span class="line"><span class="comment">└───────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>hasAll：判断数组里面是否包含某个子数组，如果包含，返回 1；不包含，返回0</strong></p>
<p><strong>注意：空数组是任意数组的子集；Null 会被看成是普通的值；数组中的元素顺序没有要求；1.0 和 1 被视为相等</strong></p>
<ul>
<li><code>hasAll([], [])：返回 1</code></li>
<li><code>hasAll([1, Null], [Null])：返回 1</code></li>
<li><code>hasAll([1.0, 2.0, 3.0], [2.0, 3.0, 1.0])：返回 1，因为元素顺序无影响，并且 1.0 和 1 被视为相等</code></li>
<li><code>hasAll([&#39;a&#39;, &#39;b&#39;], [&#39;a&#39;])：返回 1</code></li>
<li><code>hasAll([&#39;a&#39;, &#39;b&#39;], [&#39;c&#39;])：返回 0</code></li>
<li><code>hasAll([[1, 2], [3, 4]], [[1, 2], [3, 4]])：返回 1，嵌套数组也是可以的</code></li>
</ul>
<p><strong>在 has 函数里面也有嵌套数组，但是维度不同。比如 has(a, b)：如果 a 是维度为 N 的数组，那么 b 必须是维度为 N - 1 的数组；而 hasAll 则要求 a 和 b 的维度必须相同。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">11</span>, <span class="number">22</span>]] <span class="keyword">AS</span> arr, [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">11</span>, <span class="number">22</span>]] <span class="keyword">AS</span> <span class="keyword">subset</span> <span class="keyword">SELECT</span> hasAll(arr, <span class="keyword">subset</span>)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─hasAll(arr, subset)─┐</span></span><br><span class="line"><span class="comment">│                   1 │</span></span><br><span class="line"><span class="comment">└─────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 我们说 SELECT 里面别名可以给其它字段使用，因此下面这种做法也是合法的</span></span><br><span class="line"><span class="keyword">WITH</span> [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">11</span>, <span class="number">22</span>]] <span class="keyword">AS</span> arr, arr <span class="keyword">AS</span> <span class="keyword">subset</span> <span class="keyword">SELECT</span> hasAll(arr, <span class="keyword">subset</span>)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─hasAll(arr, subset)─┐</span></span><br><span class="line"><span class="comment">│                   1 │</span></span><br><span class="line"><span class="comment">└─────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>hasAny：判断两个数组里面是否有相同的元素，只要有 1 个相同的元素，返回 1；否则，返回 0</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> hasAny([<span class="number">1.0</span>, <span class="number">2.0</span>], [<span class="number">1</span>]), hasAny([<span class="keyword">Null</span>], [<span class="number">1</span>, <span class="keyword">Null</span>])</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─hasAny([1., 2.], [1])─┬─hasAny([NULL], [1, NULL])─┐</span></span><br><span class="line"><span class="comment">│                     1 │                         1 │</span></span><br><span class="line"><span class="comment">└───────────────────────┴───────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> hasAny([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]], [[<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─hasAny([[1, 2], [3, 4]], [[3, 4]])─┐</span></span><br><span class="line"><span class="comment">│                                  1 │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>hasSubstr：和 hasAll 类似，但是顺序有要求，hasAll(arr, subset) 要求的是 subset 中的元素在 arr 中都出现即可；但是 hasSubstr 函数则不仅要求 subset 中的元素在 arr 中都出现，并且还要以相同的顺序。举个栗子：</strong></p>
<ul>
<li><code>hasSubstr([1, 2, 3], [2, 3])：返回 1</code></li>
<li><code>hasSubstr([1, 2, 3], [3, 2])：返回 0</code></li>
<li><code>hasSubstr([[1, 2], [2, 1], [3, 2]], [[3, 2]])：返回 1</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 两个数组的维度必须相同</span></span><br><span class="line"><span class="keyword">SELECT</span> hasSubstr([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">3</span>, <span class="number">2</span>]), hasSubstr([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─hasSubstr([1, 2, 3], [3, 2])─┬─hasSubstr([1, 2, 3], [2, 3])─┐</span></span><br><span class="line"><span class="comment">│                            0 │                            1 │</span></span><br><span class="line"><span class="comment">└──────────────────────────────┴──────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>indexOf：查找某个元素第一次在数组中出现的位置，索引从 1 开始；如果不存在，则返回 0</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="keyword">Null</span>, <span class="number">99</span>] <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> indexOf(arr, <span class="number">100</span>), indexOf(arr, <span class="number">99</span>), indexOf(arr, <span class="keyword">Null</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─indexOf(arr, 100)─┬─indexOf(arr, 99)─┬─indexOf(arr, NULL)─┐</span></span><br><span class="line"><span class="comment">│                 0 │                5 │                  4 │</span></span><br><span class="line"><span class="comment">└───────────────────┴──────────────────┴────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayCount：查找一个数组中非 0 元素的个数，该数组类的元素类型必须是 UInt8，并且不能包含 Null 值。因为一旦包含 Null，那么类型就不是 UInt8 了，而是 Nullable(UInt8)</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayCount([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]), arrayCount([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">0</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayCount([1, 2, 3])─┬─arrayCount([1, 2, 3, 4, 0])─┐</span></span><br><span class="line"><span class="comment">│                     3 │                           4 │</span></span><br><span class="line"><span class="comment">└───────────────────────┴─────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>此外 arrayCount 还有一种用法，就是接收一个函数和一个数组：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">0</span>] <span class="keyword">AS</span> arr </span><br><span class="line"><span class="keyword">SELECT</span> arrayCount(arr), </span><br><span class="line">       arrayCount(x <span class="operator">-</span><span class="operator">&gt;</span> <span class="built_in">cast</span>(x <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> UInt8), arr)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayCount(arr)─┬─arrayCount(lambda(tuple(x), CAST(plus(x, 1), &#x27;UInt8&#x27;)), arr)─┐</span></span><br><span class="line"><span class="comment">│               4 │                                                            5 │</span></span><br><span class="line"><span class="comment">└─────────────────┴──────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*</span></span><br></pre></td></tr></table></figure>

<p><strong>ClickHouse 中的函数类似于 C++ 中的 lambda 表达式，x -&gt; x + 1 相当于将 arr 中的每一个元素都加上 1，但结果得到整型是 UInt16，所以需要使用 cast 转成 UInt8，否则报错。另外，加上 1 之后就没有为 0 的元素了，所以返回的结果是 5。</strong></p>
<p><strong>countEqual：返回某个元素在数组中出现的次数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="keyword">Null</span>, <span class="keyword">Null</span>] <span class="keyword">as</span> arr <span class="keyword">SELECT</span> countEqual(arr, <span class="number">1</span>), countEqual(arr, <span class="keyword">Null</span>)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─countEqual(arr, 1)─┬─countEqual(arr, NULL)─┐</span></span><br><span class="line"><span class="comment">│                  3 │                     2 │</span></span><br><span class="line"><span class="comment">└────────────────────┴───────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayEnumerate：等价于先计算出数组的长度，假设为 N，然后返回 range(1, N + 1)</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayEnumerate([<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayEnumerate([2, 2, 2, 2])─┐</span></span><br><span class="line"><span class="comment">│ [1,2,3,4]                    │</span></span><br><span class="line"><span class="comment">└──────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayEnumerateUniq：从数组的第一个元素开始，每重复一次就加 1</strong></p>
<p><strong>光说不好理解，直接看例子，然后画图说明：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayEnumerateUniq([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayEnumerateUniq([&#x27;a&#x27;, &#x27;a&#x27;, &#x27;c&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;b&#x27;])─┐</span></span><br><span class="line"><span class="comment">│ [1,2,1,1,2,3,2,3]                                            │</span></span><br><span class="line"><span class="comment">└──────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/11/ClickHouse%20%E6%95%B0%E7%BB%84%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD(%E5%8D%81)/1229382-20210904151135342-481015945.png" alt="img"></p>
<p><strong>arrayEnumerateUniq 还可以接收多个数组，这些数据具有相同的长度，相信你已经知道它的作用了：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayEnumerateUniq([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayEnumerateUniq([&#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;a&#x27;], [1, 2, 2, 1])─┐</span></span><br><span class="line"><span class="comment">│ [1,1,1,2]                                              │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 举个不恰当的例子</span></span><br><span class="line"><span class="comment">-- 你就可以理解为：arrayEnumerateUniq( [(&#x27;a&#x27;, 1), (&#x27;a&#x27;, 2), (&#x27;b&#x27;, 2), (&#x27;a&#x27;, 1)] )</span></span><br><span class="line"><span class="comment">-- 此时会将多个数组作为一个整体来进行判断，因此这些数组都必须有相同的长度</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayPopBack：移除数组中的最后一个元素</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayPopBack([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayPopBack([1, 2, 3])─┐</span></span><br><span class="line"><span class="comment">│ [1,2]                   │</span></span><br><span class="line"><span class="comment">└─────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>显然它是可以被嵌套的：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> arrayPopBack(arrayPopBack(arr))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayPopBack(arrayPopBack(arr))─┐</span></span><br><span class="line"><span class="comment">│ [1]                             │</span></span><br><span class="line"><span class="comment">└─────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：对空数组使用 arrayPopBack 不会报错，得到的还是空数组。</strong></p>
<p><strong>arrayPopFront：移除数组中的第一个元素</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayPopFront([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayPopFront([1, 2, 3])─┐</span></span><br><span class="line"><span class="comment">│ [2,3]                    │</span></span><br><span class="line"><span class="comment">└──────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>和 arrayPopBack 一样，也可以被嵌套，并且对空数组使用也不会报错，还是得到空数组。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> arrayPopFront(arrayPopFront(arr));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayPopFront(arrayPopFront(arr))─┐</span></span><br><span class="line"><span class="comment">│ [3]                               │</span></span><br><span class="line"><span class="comment">└───────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayPushBack：从数组的尾部塞进一个元素</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayPushBack([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">1</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayPushBack([1, 2, 3], 1)─┐</span></span><br><span class="line"><span class="comment">│ [1,2,3,1]                   │</span></span><br><span class="line"><span class="comment">└─────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>添加的时候记得类型要匹配，如果添加了 Null，那么数组会变成 Nullable。</strong></p>
<p><strong>arrayPushFront：从数组的头部塞进一个元素</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayPushFront([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], <span class="string">&#x27;d&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayPushFront([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;], &#x27;d&#x27;)─┐</span></span><br><span class="line"><span class="comment">│ [&#x27;d&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]                    │</span></span><br><span class="line"><span class="comment">└──────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>添加的时候记得类型要匹配，如果添加了 Null，那么数组会变成 Nullable。</strong></p>
<p><strong>arrayResize：改变数组的长度</strong></p>
<ul>
<li><code>如果指定的长度比原来的长度大，那么会用零值从尾部进行填充</code></li>
<li><code>如果指定的长度比原来的长度大，那么会从尾部进行截断</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayResize(<span class="keyword">range</span>(<span class="number">4</span>), <span class="number">7</span>), arrayResize(<span class="keyword">range</span>(<span class="number">4</span>), <span class="number">2</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayResize(range(4), 7)─┬─arrayResize(range(4), 2)─┐</span></span><br><span class="line"><span class="comment">│ [0,1,2,3,0,0,0]          │ [0,1]                    │</span></span><br><span class="line"><span class="comment">└──────────────────────────┴──────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>在填充的时候，也可以使用指定的值进行填充：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayResize(<span class="keyword">range</span>(<span class="number">4</span>), <span class="number">7</span>, <span class="number">66</span>), arrayResize(<span class="keyword">range</span>(<span class="number">4</span>), <span class="number">7</span>, <span class="keyword">Null</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayResize(range(4), 7, 66)─┬─arrayResize(range(4), 7, NULL)─┐</span></span><br><span class="line"><span class="comment">│ [0,1,2,3,66,66,66]           │ [0,1,2,3,NULL,NULL,NULL]       │</span></span><br><span class="line"><span class="comment">└──────────────────────────────┴────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arraySlice：返回数组的一个片段</strong></p>
<ul>
<li><code>arraySlice(arr, M)：返回从索引为 M 开始以及之后的所有元素</code></li>
<li><code>arraySlice(arr, M, N)：从索引为 M 的元素开始，总共返回 N 个元素</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arraySlice(<span class="keyword">range</span>(<span class="number">1</span>, <span class="number">10</span>), <span class="number">3</span>), arraySlice(<span class="keyword">range</span>(<span class="number">1</span>, <span class="number">10</span>), <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arraySlice(range(1, 10), 3)─┬─arraySlice(range(1, 10), 3, 4)─┐</span></span><br><span class="line"><span class="comment">│ [3,4,5,6,7,8,9]             │ [3,4,5,6]                      │</span></span><br><span class="line"><span class="comment">└─────────────────────────────┴────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arraySort：对数据进行排序，然后返回</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arraySort([<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>]), arraySort([<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arraySort([2, 3, 1])─┬─arraySort([&#x27;abc&#x27;, &#x27;ab&#x27;, &#x27;c&#x27;])─┐</span></span><br><span class="line"><span class="comment">│ [1,2,3]              │ [&#x27;ab&#x27;,&#x27;abc&#x27;,&#x27;c&#x27;]              │</span></span><br><span class="line"><span class="comment">└──────────────────────┴───────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>字符串会按照字典序排序返回，整型、浮点型、日期都会按照大小返回。</strong></p>
<p><strong>问题来了，如果我们希望按照字符串的长度排序该怎么办呢？所以 arraySort 还支持传递一个自定义函数：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按照数组中元素的长度进行排序</span></span><br><span class="line"><span class="keyword">SELECT</span> arraySort(x <span class="operator">-</span><span class="operator">&gt;</span> length(x),[<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arraySort(lambda(tuple(x), length(x)), [&#x27;abc&#x27;, &#x27;ab&#x27;, &#x27;c&#x27;])─┐</span></span><br><span class="line"><span class="comment">│ [&#x27;c&#x27;,&#x27;ab&#x27;,&#x27;abc&#x27;]                                           │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 先按照正负号排序，小于 0 的排在大于 0 的左边，然后各自再按照绝对值进行排序</span></span><br><span class="line"><span class="keyword">SELECT</span> arraySort(x <span class="operator">-</span><span class="operator">&gt;</span> (x <span class="operator">&gt;</span> <span class="number">0</span>, <span class="built_in">abs</span>(x)), [<span class="number">-3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arraySort(lambda(tuple(x), tuple(greater(x, 0), abs(x))), [-3, 1, 2, -1, -2, 3])─┐</span></span><br><span class="line"><span class="comment">│ [-1,-2,-3,1,2,3]                                                                 │</span></span><br><span class="line"><span class="comment">└──────────────────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>我去，这 ClickHouse 也太强大了吧，这简直不像是在写 SQL 了，都有点像写 Python 代码了，所以 ClickHouse 这么火不是没有原因的。</strong></p>
<p><strong>另外当出现空值或 NaN 的话，它们的顺序如下：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-inf 普通数值 inf NaN Null</span><br></pre></td></tr></table></figure>

<p><strong>所以 arraySort 如果接收一个参数，那么该参数必须是一个数组，然后 ClickHouse 按照默认的规则进行排序；如果接收两个参数，那么第一个参数是匿名函数，第二个参数是数组，此时 ClickHouse 会按照我们定义的函数来给数组排序；但其实 arraySort 还可以接收三个参数，第一个参数依旧是函数，然后第二个参数和第三个参数都是数组，此时会用数组给数组排序，举个栗子：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 因为有两个数组，所以匿名函数要有两个参数，x 表示第一个数组、y 表示第二个数组</span></span><br><span class="line"><span class="comment">-- 首先不管排序规则是什么，最终输出的都是第一个数组</span></span><br><span class="line"><span class="comment">-- x, y -&gt; y 就表示按照第二个数组来给第一个数组进行排序输出</span></span><br><span class="line"><span class="keyword">SELECT</span> arraySort(x, y <span class="operator">-</span><span class="operator">&gt;</span> y, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">22</span>, <span class="number">11</span>, <span class="number">33</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arraySort(lambda(tuple(x, y), y), [1, 2, 3], [22, 11, 33])─┐</span></span><br><span class="line"><span class="comment">│ [2,1,3]                                                    │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 同理 x, y -&gt; x 返回的还是 [1, 2, 3]、 x, y -&gt; -x 返回的是 [3, 2, 1]</span></span><br><span class="line"><span class="comment">-- 只不过此时第二个数组就用不上了</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayReverseSort：对数据进行逆序排序，然后返回</strong></p>
<p><strong>该函数你可以认为它是先按照 arraySort 排序，然后将结果再反过来，举个栗子：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arraySort(x <span class="operator">-</span><span class="operator">&gt;</span> <span class="operator">-</span>x, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]) sort, arrayReverseSort(x <span class="operator">-</span><span class="operator">&gt;</span> <span class="operator">-</span>x, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]) reverse_sort;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─sort────┬─reverse_sort─┐</span></span><br><span class="line"><span class="comment">│ [3,2,1] │ [1,2,3]      │</span></span><br><span class="line"><span class="comment">└─────────┴──────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>指定了匿名函数，按照相反数进行排序，因为 -3 &lt; -2 &lt; -1，所示 arraySort 排序之后就是 [3, 2, 1]，然后 arrayReverseSort 则是在其基础上直接返回，所以得到的还是 [1, 2, 3]。</strong></p>
<p><strong>至于其它用法和 arraySort 都是一样的，可以看做是在 arraySort 的基础上做了一次反转。不过有一点需要注意，那就是 Null 值和 NaN：</strong></p>
<ul>
<li><code>arraySort：-inf 普通数值 inf NaN Null</code></li>
<li><code>arrayReverseSort：inf 普通数值 -inf NaN Null</code></li>
</ul>
<p><strong>即使是 arrayReverseSort，NaN 和 Null 依然排在最后面。</strong></p>
<p><strong>arrayUniq：返回数组中不同元素的数量</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayUniq([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayUniq([1, 2, 3, 1, 4])─┐</span></span><br><span class="line"><span class="comment">│                          4 │</span></span><br><span class="line"><span class="comment">└────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>也可以传递多个长度相同的数组，会依次取出所有数组中相同位置的元素，然后拼成元组，并计算这些不重复的元组的数量，举个栗子：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 相当于判断 arrayUniq( [(&#x27;a&#x27;, 1, 3), (&#x27;a&#x27;, 1, 3), (&#x27;b&#x27;, 2, 3)] )</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayUniq([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayUniq([&#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;], [1, 1, 2], [3, 3, 3])─┐</span></span><br><span class="line"><span class="comment">│                                                2 │</span></span><br><span class="line"><span class="comment">└──────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayJoin：将数组展开成多行</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayJoin(<span class="keyword">range</span>(<span class="number">1</span>, <span class="number">7</span>));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayJoin(range(1, 7))─┐</span></span><br><span class="line"><span class="comment">│                      1 │</span></span><br><span class="line"><span class="comment">│                      2 │</span></span><br><span class="line"><span class="comment">│                      3 │</span></span><br><span class="line"><span class="comment">│                      4 │</span></span><br><span class="line"><span class="comment">│                      5 │</span></span><br><span class="line"><span class="comment">│                      6 │</span></span><br><span class="line"><span class="comment">└────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- || 表示字符串拼接，当 arrayJoin 展开成多行的时候，会自动和其它字段组合</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayJoin(<span class="keyword">range</span>(<span class="number">1</span>, <span class="number">7</span>)) <span class="keyword">AS</span> v, <span class="string">&#x27;A00&#x27;</span> <span class="operator">||</span> <span class="built_in">cast</span>(v <span class="keyword">AS</span> String);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v─┬─concat(&#x27;A00&#x27;, CAST(arrayJoin(range(1, 7)), &#x27;String&#x27;))─┐</span></span><br><span class="line"><span class="comment">│ 1 │ A001                                                  │</span></span><br><span class="line"><span class="comment">│ 2 │ A002                                                  │</span></span><br><span class="line"><span class="comment">│ 3 │ A003                                                  │</span></span><br><span class="line"><span class="comment">│ 4 │ A004                                                  │</span></span><br><span class="line"><span class="comment">│ 5 │ A005                                                  │</span></span><br><span class="line"><span class="comment">│ 6 │ A006                                                  │</span></span><br><span class="line"><span class="comment">└───┴───────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>如果出现了多个 arrayJoin ，那么会做笛卡尔积：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayJoin([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]), arrayJoin([<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>])；</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayJoin([1, 2, 3])─┬─arrayJoin([11, 22, 33])─┐</span></span><br><span class="line"><span class="comment">│                    1 │                      11 │</span></span><br><span class="line"><span class="comment">│                    1 │                      22 │</span></span><br><span class="line"><span class="comment">│                    1 │                      33 │</span></span><br><span class="line"><span class="comment">│                    2 │                      11 │</span></span><br><span class="line"><span class="comment">│                    2 │                      22 │</span></span><br><span class="line"><span class="comment">│                    2 │                      33 │</span></span><br><span class="line"><span class="comment">│                    3 │                      11 │</span></span><br><span class="line"><span class="comment">│                    3 │                      22 │</span></span><br><span class="line"><span class="comment">│                    3 │                      33 │</span></span><br><span class="line"><span class="comment">└──────────────────────┴─────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>提到了 arrJoin，那么就必须提一下 groupArray，这算是一个聚合函数，它和 arrayJoin 作用相反，将多行数据合并成数组。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> number <span class="keyword">FROM</span> numbers(<span class="number">5</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─number─┐</span></span><br><span class="line"><span class="comment">│      0 │</span></span><br><span class="line"><span class="comment">│      1 │</span></span><br><span class="line"><span class="comment">│      2 │</span></span><br><span class="line"><span class="comment">│      3 │</span></span><br><span class="line"><span class="comment">│      4 │</span></span><br><span class="line"><span class="comment">└────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> groupArray(number) <span class="keyword">FROM</span> numbers(<span class="number">5</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─groupArray(number)─┐</span></span><br><span class="line"><span class="comment">│ [0,1,2,3,4]        │</span></span><br><span class="line"><span class="comment">└────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>除了 groupArray，还有一个 groupUniqArray，从名字上看显然多了一个去重的功能。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SELECT arrayJoin([1, 1, 2, 2, 3]) 会自动展开成多行</span></span><br><span class="line"><span class="comment">-- 当然我们也可以将它作为一张表</span></span><br><span class="line"><span class="keyword">SELECT</span> v <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> arrayJoin([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]) v);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v─┐</span></span><br><span class="line"><span class="comment">│ 1 │</span></span><br><span class="line"><span class="comment">│ 1 │</span></span><br><span class="line"><span class="comment">│ 2 │</span></span><br><span class="line"><span class="comment">│ 2 │</span></span><br><span class="line"><span class="comment">│ 3 │</span></span><br><span class="line"><span class="comment">└───┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 通过 groupArray 再变成原来的数组</span></span><br><span class="line"><span class="keyword">SELECT</span> groupArray(v) <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> arrayJoin([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]) v);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─groupArray(v)─┐</span></span><br><span class="line"><span class="comment">│ [1,1,2,2,3]   │</span></span><br><span class="line"><span class="comment">└───────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果使用 groupUniqArray 的话</span></span><br><span class="line"><span class="keyword">SELECT</span> groupUniqArray(v) <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> arrayJoin([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]) v);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─groupUniqArray(v)─┐</span></span><br><span class="line"><span class="comment">│ [2,1,3]           │</span></span><br><span class="line"><span class="comment">└───────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayDifference：计算数组中每相邻的两个元素的差值</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 第一个元素固定为 0，第二个元素为 3 - 1，第三个元素为 4 - 3，以此类推</span></span><br><span class="line"><span class="comment">-- 相邻元素相减</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayDifference([<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">10</span>])</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayDifference([1, 3, 4, 7, 10])─┐</span></span><br><span class="line"><span class="comment">│ [0,2,1,3,3]                       │</span></span><br><span class="line"><span class="comment">└───────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayDistinct：对数组中的元素进行去重</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayDistinct([<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayDistinct([1, 1, 1, 2, 2, 3])─┐</span></span><br><span class="line"><span class="comment">│ [1,2,3]                           │</span></span><br><span class="line"><span class="comment">└───────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayEnumerateDense：返回一个和原数组大小相等的数组，并指示每个元素在原数组中首次出现的位置（索引都是从 1 开始）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 22 首次出现在索引为 1 的位置、1 首次出现在索引为 2 的位置</span></span><br><span class="line"><span class="comment">-- 13 首次出现在索引为 4 的位置，因此结果为 [1, 2, 1, 3, 2, 3]</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayEnumerateDense([<span class="number">22</span>, <span class="number">1</span>, <span class="number">22</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">13</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayEnumerateDense([22, 1, 22, 13, 1, 13])─┐</span></span><br><span class="line"><span class="comment">│ [1,2,1,3,2,3]                               │</span></span><br><span class="line"><span class="comment">└─────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayIntersect：接收多个数组，并取它们的交集</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayIntersect([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">3</span>], [<span class="number">3</span>, <span class="number">4</span>]), arrayIntersect([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">3</span>], [<span class="number">2</span>, <span class="number">4</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayIntersect([1, 2], [2, 3], [3, 4])─┬─arrayIntersect([1, 2], [2, 3], [2, 4])─┐</span></span><br><span class="line"><span class="comment">│ []                                     │ [2]                                    │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────┴────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayReduce：将一个聚合函数作用在数组上，举个栗子：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayReduce(<span class="string">&#x27;max&#x27;</span>, [<span class="number">1</span>, <span class="number">23</span>, <span class="number">6</span>]), arrayReduce(<span class="string">&#x27;sum&#x27;</span>, [<span class="number">1</span>, <span class="number">23</span>, <span class="number">6</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayReduce(&#x27;max&#x27;, [1, 23, 6])─┬─arrayReduce(&#x27;sum&#x27;, [1, 23, 6])─┐</span></span><br><span class="line"><span class="comment">│                             23 │                             30 │</span></span><br><span class="line"><span class="comment">└────────────────────────────────┴────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>可能有人觉得直接用聚合函数不就好了，答案是不行的，因为这些聚合函数针对的都是多行结果集，而不是数组。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 相当于只有一行数据，所以返回其本身</span></span><br><span class="line"><span class="comment">-- 如果是 sum 就直接报错了， 因为数组之间不能进行加法运算</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">max</span>([<span class="number">11</span>, <span class="number">33</span>, <span class="number">22</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─max([11, 33, 22])─┐</span></span><br><span class="line"><span class="comment">│ [11,33,22]        │</span></span><br><span class="line"><span class="comment">└───────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果想返回 33，我们应该将这个数组给展开，变成多行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">max</span>(arrayJoin([<span class="number">11</span>, <span class="number">33</span>, <span class="number">22</span>]));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─max(arrayJoin([11, 33, 22]))─┐</span></span><br><span class="line"><span class="comment">│                           33 │</span></span><br><span class="line"><span class="comment">└──────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>所以聚合函数针对的是多行，而不是数组，如果想用聚合函数，那么应该将数组给展开。或者使用这里的 arrayReduce，相当于将两步合在一起了。当然我们也可以不用 arrayReduce，因为 ClickHouse 为了数组专门提供了相应的操作，比如求数组中最大的元素可以使用更强大的 arrayMax，后面说。</strong></p>
<p><strong>arrayReduceInRanges：对给定范围内的数组元素应用聚合函数，光说不好解释，直接看例子：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会对数组中索引为 1 开始向后的 5 个元素进行 sum，结果为 15</span></span><br><span class="line"><span class="comment">-- 会对数组中索引为 2 开始向后的 4 个元素进行 sum，结果为 14</span></span><br><span class="line"><span class="comment">-- 会对数组中索引为 1 开始向后的 3 个元素进行 sum，结果为 6</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayReduceInRanges(</span><br><span class="line">    <span class="string">&#x27;sum&#x27;</span>,</span><br><span class="line">    [(<span class="number">1</span>, <span class="number">5</span>), (<span class="number">2</span>, <span class="number">4</span>), (<span class="number">1</span>, <span class="number">3</span>)],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayReduceInRanges(&#x27;sum&#x27;, array((1, 5), (2, 4), (1, 3)), [1, 2, 3, 4, 5])─┐</span></span><br><span class="line"><span class="comment">│ [15,14,6]                                                                  │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以上等价于</span></span><br><span class="line"><span class="keyword">WITH</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] <span class="keyword">AS</span> arr </span><br><span class="line"><span class="keyword">SELECT</span> [arrayReduce(<span class="string">&#x27;sum&#x27;</span>, arraySlice(arr, <span class="number">1</span>, <span class="number">5</span>)), </span><br><span class="line">        arrayReduce(<span class="string">&#x27;sum&#x27;</span>, arraySlice(arr, <span class="number">2</span>, <span class="number">4</span>)),</span><br><span class="line">        arrayReduce(<span class="string">&#x27;sum&#x27;</span>, arraySlice(arr, <span class="number">1</span>, <span class="number">3</span>))] <span class="keyword">AS</span> v</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v─────────┐</span></span><br><span class="line"><span class="comment">│ [15,14,6] │</span></span><br><span class="line"><span class="comment">└───────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayReverse：对数据进行逆序，然后返回；我们之前还介绍了一个 arrayReverseSort，它在逆序之前会先排序，而这里的 arrayReverse 只是单纯的逆序</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- arrayReverse 和 reverse 作用相同</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayReverse([<span class="number">22</span>, <span class="number">33</span>, <span class="number">11</span>]), reverse([<span class="number">22</span>, <span class="number">33</span>, <span class="number">11</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayReverse([22, 33, 11])─┬─reverse([22, 33, 11])─┐</span></span><br><span class="line"><span class="comment">│ [11,33,22]                 │ [11,33,22]            │</span></span><br><span class="line"><span class="comment">└────────────────────────────┴───────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayFlatten：将数组扁平化</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- arrayFlatten 也可以使用 flatten 代替</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayFlatten([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>]]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayFlatten([[1, 2, 3], [11, 22, 33]])─┐</span></span><br><span class="line"><span class="comment">│ [1,2,3,11,22,33]                        │</span></span><br><span class="line"><span class="comment">└─────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>我们之前还介绍了一个 arrayConcat，可以对比一下两者的区别</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayConcat ([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayConcat([1, 2, 3], [11, 22, 33])─┐</span></span><br><span class="line"><span class="comment">│ [1,2,3,11,22,33]                     │</span></span><br><span class="line"><span class="comment">└──────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayCompact：从数组中删除连续重复的元素</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayCompact([<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="keyword">Null</span>, <span class="keyword">Null</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayCompact([2, 2, 1, 1, 1, 3, 3, NULL, NULL])─┐</span></span><br><span class="line"><span class="comment">│ [2,1,3,NULL]                                    │</span></span><br><span class="line"><span class="comment">└─────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>我们看到作用类似于之前介绍的 arrayDistinct，但两者还是有区别的。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayDistinct([<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>])</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayDistinct([2, 2, 1, 1, 1, 3, 3, NULL, NULL])─┐</span></span><br><span class="line"><span class="comment">│ [2,1,3]                                          │</span></span><br><span class="line"><span class="comment">└──────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>我们发现 arrayDistinct 不包含 Null 值。</strong></p>
<p><strong>arrayZip：类似于 Python 中的 zip，直接看示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayZip([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayZip([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;], [1, 2, 3], [&#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;])─┐</span></span><br><span class="line"><span class="comment">│ [(&#x27;a&#x27;,1,&#x27;x&#x27;),(&#x27;b&#x27;,2,&#x27;y&#x27;),(&#x27;c&#x27;,3,&#x27;z&#x27;)]                 │</span></span><br><span class="line"><span class="comment">└───────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayMap：对数组中每一个元素都作用相同的函数，根据函数的返回值创建一个新的数组，非常常用的一个功能。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayMap(x <span class="operator">-</span><span class="operator">&gt;</span> (x, <span class="number">1</span>), [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayMap(lambda(tuple(x), tuple(x, 1)), [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;])─┐</span></span><br><span class="line"><span class="comment">│ [(&#x27;a&#x27;,1),(&#x27;b&#x27;,1),(&#x27;c&#x27;,1)]                                │</span></span><br><span class="line"><span class="comment">└──────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> arrayMap(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">*</span> <span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]) v1, <span class="built_in">sum</span>(arrayJoin(v1)) v2, arrayReduce(<span class="string">&#x27;sum&#x27;</span>, v1) v3;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v1──────┬─v2─┬─v3─┐</span></span><br><span class="line"><span class="comment">│ [2,4,6] │ 12 │ 12 │</span></span><br><span class="line"><span class="comment">└─────────┴────┴────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>当然也可以作用嵌套数组：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayMap(x <span class="operator">-</span><span class="operator">&gt;</span> arrayReduce(<span class="string">&#x27;sum&#x27;</span>, x), [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>], [<span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>]]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayMap(lambda(tuple(x), arrayReduce(&#x27;sum&#x27;, x)), [[1, 2, 3], [11, 22, 33], [33, 44, 55]])─┐</span></span><br><span class="line"><span class="comment">│ [6,66,132]                                                                                 │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> arrayMap(x <span class="operator">-</span><span class="operator">&gt;</span> arrayReduce(<span class="string">&#x27;max&#x27;</span>, x), [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>], [<span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>]]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayMap(lambda(tuple(x), arrayReduce(&#x27;max&#x27;, x)), [[1, 2, 3], [11, 22, 33], [33, 44, 55]])─┐</span></span><br><span class="line"><span class="comment">│ [3,33,55]                                                                                  │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> arrayMap(x <span class="operator">-</span><span class="operator">&gt;</span> arrayReduce(<span class="string">&#x27;min&#x27;</span>, x), [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>], [<span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>]]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayMap(lambda(tuple(x), arrayReduce(&#x27;max&#x27;, x)), [[1, 2, 3], [11, 22, 33], [33, 44, 55]])─┐</span></span><br><span class="line"><span class="comment">│ [1,11,33]                                                                                  │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>也可以作用多个数组，这些数组的长度必须相等。此外，有多个数组，函数就要有多少个参数：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 得到的是 [1 + 11 + 33, 2 + 22 + 44, 3 + 33 + 55]</span></span><br><span class="line"><span class="comment">-- 如果是 arrayMap(x -&gt; arrayReduce(&#x27;sum&#x27;, x), [[1, 2, 3], [11, 22, 33], [33, 44, 55]])</span></span><br><span class="line"><span class="comment">-- 那么得到的是 [1 + 2 + 3, 11 + 22 + 33, 33 + 44 + 55]</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayMap(x, y, z <span class="operator">-</span><span class="operator">&gt;</span> arrayReduce(<span class="string">&#x27;sum&#x27;</span>, [x, y, z]), [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>], [<span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>]) <span class="keyword">AS</span> v;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v──────────┐</span></span><br><span class="line"><span class="comment">│ [45,68,91] │</span></span><br><span class="line"><span class="comment">└────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> arrayMap(x, y, z <span class="operator">-</span><span class="operator">&gt;</span> (x <span class="operator">+</span> y, z), [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>], [<span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>]) <span class="keyword">AS</span> v;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v─────────────────────────┐</span></span><br><span class="line"><span class="comment">│ [(12,33),(24,44),(36,55)] │</span></span><br><span class="line"><span class="comment">└───────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayFilter：对数组中每一个元素都作用相同的函数，如果函数返回值为真（非 0），则该元素保留，否则不保留。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayFilter(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">&gt;</span> <span class="number">5</span>, [<span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">10</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayFilter(lambda(tuple(x), greater(x, 5)), [1, 4, 5, 7, 10])─┐</span></span><br><span class="line"><span class="comment">│ [7,10]                                                         │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> arrayFilter(x <span class="operator">-</span><span class="operator">&gt;</span> length(x) <span class="operator">&gt;</span> <span class="number">1</span>, [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;aaa&#x27;</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayFilter(lambda(tuple(x), greater(length(x), 1)), [&#x27;a&#x27;, &#x27;aa&#x27;, &#x27;aaa&#x27;])─┐</span></span><br><span class="line"><span class="comment">│ [&#x27;aa&#x27;,&#x27;aaa&#x27;]                                                             │</span></span><br><span class="line"><span class="comment">└──────────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> arrayFilter(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="keyword">LIKE</span> <span class="string">&#x27;sa%&#x27;</span>, [<span class="string">&#x27;satori&#x27;</span>, <span class="string">&#x27;koishi&#x27;</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayFilter(lambda(tuple(x), like(x, &#x27;sa%&#x27;)), [&#x27;satori&#x27;, &#x27;koishi&#x27;])─┐</span></span><br><span class="line"><span class="comment">│ [&#x27;satori&#x27;]                                                          │</span></span><br><span class="line"><span class="comment">└─────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayFill：对数组中每一个元素都作用相同的函数，如果函数返回值为真，则该元素保留，否则被替换为前一个元素。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 2 会被替换成 4，1 会被替换成 5</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayFill(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">&gt;=</span> <span class="number">3</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayFill(lambda(tuple(x), greaterOrEquals(x, 3)), [3, 4, 2, 5, 1])─┐</span></span><br><span class="line"><span class="comment">│ [3,4,4,5,5]                                                         │</span></span><br><span class="line"><span class="comment">└─────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第一个元素永远不会被替换，2、3、4、5 都不满足条件，因此都要换成前一个元素</span></span><br><span class="line"><span class="comment">-- 换 2 的时候，2 已经变成了 1，所以 3 的前面是 1，于是 3 也会变成 1</span></span><br><span class="line"><span class="comment">-- 4 和 5 也是同理，因此最终所有值都会变成 1</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayFill(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">&gt;=</span> <span class="number">6</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayFill(lambda(tuple(x), greaterOrEquals(x, 6)), [1, 2, 3, 4, 5])─┐</span></span><br><span class="line"><span class="comment">│ [1,1,1,1,1]                                                         │</span></span><br><span class="line"><span class="comment">└─────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayReverseFill：对数组中每一个元素都作用相同的函数，如果函数返回值为真，则该元素保留，否则被替换为后一个元素。注意：此时数组是从后往前扫描的</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 2 会被替换成 5，1 还是 1，最后一个元素不会被替换</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayReverseFill(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">&gt;=</span> <span class="number">3</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayReverseFill(lambda(tuple(x), greaterOrEquals(x, 3)), [3, 4, 2, 5, 1])─┐</span></span><br><span class="line"><span class="comment">│ [3,4,5,5,1]                                                                │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 因为数组从后往前扫描，所以 4 变成 5、3 也会变成 5，所有值都会变成 5</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayReverseFill(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">&gt;=</span> <span class="number">6</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayReverseFill(lambda(tuple(x), greaterOrEquals(x, 6)), [1, 2, 3, 4, 5])─┐</span></span><br><span class="line"><span class="comment">│ [5,5,5,5,5]                                                                │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayMin：返回数组中最小的元素</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> [<span class="number">11</span>, <span class="number">22</span>, <span class="number">8</span>, <span class="number">33</span>] <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> arrayMin(arr) v1, <span class="built_in">min</span>(arrayJoin(arr)) v2, arrayReduce(<span class="string">&#x27;min&#x27;</span>, arr) v3;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v1─┬─v2─┬─v3─┐</span></span><br><span class="line"><span class="comment">│  8 │  8 │  8 │</span></span><br><span class="line"><span class="comment">└────┴────┴────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayMin 里面还可以传递一个匿名函数：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayMin(x <span class="operator">-</span><span class="operator">&gt;</span> <span class="operator">-</span>x, [<span class="number">11</span>, <span class="number">22</span>, <span class="number">8</span>, <span class="number">33</span>])</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayMin(lambda(tuple(x), negate(x)), [11, 22, 8, 33])─┐</span></span><br><span class="line"><span class="comment">│                                                    -33 │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>会按照调用匿名函数的返回值进行判断，选择最小的元素，这里 33 在调用之后返回 -33，显然是最小值。但是这里有一个需要注意的地方，就是它返回的也是匿名函数的返回值。个人觉得应该返回 33 才对，应为我们指定函数只是希望 ClickHouse 能够按照我们指定的规则进行排序，而值还是原来的值，但 ClickHouse 这里设计有点莫测高深了。如果我们以字符串为例，那么会看的更加明显：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayMin(x <span class="operator">-</span><span class="operator">&gt;</span> length(x), [<span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;a&#x27;</span>]) v;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v─┐</span></span><br><span class="line"><span class="comment">│ 1 │</span></span><br><span class="line"><span class="comment">└───┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>我们看到居然返回了一个 1，我们的本意是想选择长度最短的字符串，但是返回的是最短字符串的长度，也就是返回的不是 ‘a’，而是 length(‘a’)。</strong></p>
<p><strong>arrayMax：返回数组中最大的元素</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> [<span class="number">11</span>, <span class="number">22</span>, <span class="number">8</span>, <span class="number">33</span>] <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> arrayMax(arr) v1, <span class="built_in">max</span>(arrayJoin(arr)) v2, arrayReduce(<span class="string">&#x27;max&#x27;</span>, arr) v3;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v1─┬─v2─┬─v3─┐</span></span><br><span class="line"><span class="comment">│ 33 │ 33 │ 33 │</span></span><br><span class="line"><span class="comment">└────┴────┴────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>也可以加上一个匿名函数，作用和 arrayMin 完全一样，并且返回的也是函数调用之后的结果。</strong></p>
<p><strong>arraySum：对数组求总和</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">range</span>(<span class="number">1</span>, <span class="number">101</span>) <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> arraySum(arr), arrayReduce(<span class="string">&#x27;sum&#x27;</span>, arr), <span class="built_in">sum</span>(arrayJoin(arr));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arraySum(arr)─┬─arrayReduce(&#x27;sum&#x27;, arr)─┬─sum(arrayJoin(arr))─┐</span></span><br><span class="line"><span class="comment">│          5050 │                    5050 │                5050 │</span></span><br><span class="line"><span class="comment">└───────────────┴─────────────────────────┴─────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>同样可以加一个匿名函数：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">range</span>(<span class="number">1</span>, <span class="number">101</span>) <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> arraySum(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">*</span> <span class="number">2</span>, arr);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arraySum(lambda(tuple(x), multiply(x, 2)), arr)─┐</span></span><br><span class="line"><span class="comment">│                                           10100 │</span></span><br><span class="line"><span class="comment">└─────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayProduct：对数组求总乘积</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayProduct([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayProduct([1, 2, 3, 4, 5])─┐</span></span><br><span class="line"><span class="comment">│                           120 │</span></span><br><span class="line"><span class="comment">└───────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>同样可以加一个匿名函数：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> arrayProduct(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">+</span> <span class="number">1</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayProduct(lambda(tuple(x), plus(x, 1)), [1, 2, 3, 4, 5])─┐</span></span><br><span class="line"><span class="comment">│                                                         720 │</span></span><br><span class="line"><span class="comment">└─────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayAvg：对数组取平均值</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">range</span>(<span class="number">1</span>, <span class="number">101</span>) <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> arrayAvg(arr), arrayReduce(<span class="string">&#x27;avg&#x27;</span>, arr), <span class="built_in">avg</span>(arrayJoin(arr));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayAvg(arr)─┬─arrayReduce(&#x27;avg&#x27;, arr)─┬─avg(arrayJoin(arr))─┐</span></span><br><span class="line"><span class="comment">│          50.5 │                    50.5 │                50.5 │</span></span><br><span class="line"><span class="comment">└───────────────┴─────────────────────────┴─────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>同样可以加一个匿名函数：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">range</span>(<span class="number">1</span>, <span class="number">101</span>) <span class="keyword">AS</span> arr <span class="keyword">SELECT</span> arrayAvg(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">*</span> <span class="number">2</span>, arr);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayAvg(lambda(tuple(x), multiply(x, 2)), arr)─┐</span></span><br><span class="line"><span class="comment">│                                             101 │</span></span><br><span class="line"><span class="comment">└─────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>arrayCumSum：对数组进行累和</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 第一个元素不变</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayCumSum([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayCumSum([1, 2, 3, 4, 5])─┐</span></span><br><span class="line"><span class="comment">│ [1,3,6,10,15]                │</span></span><br><span class="line"><span class="comment">└──────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>同样可以加一个匿名函数：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 第一个元素不变</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayCumSum(x <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">*</span> <span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]), arrayCumSum([<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayCumSum(lambda(tuple(x), multiply(x, 2)), [1, 2, 3, 4, 5])─┬─arrayCumSum([2, 4, 6, 8, 10])─┐</span></span><br><span class="line"><span class="comment">│ [2,6,12,20,30]                                                 │ [2,6,12,20,30]                │</span></span><br><span class="line"><span class="comment">└────────────────────────────────────────────────────────────────┴───────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><strong>以上就是关于 ClickHouse 数组的一些函数操作，可以说是非常强大了，不光是功能强大，用起来也很舒服，仿佛有种在写 Python 代码的感觉。当然以上并不是关于数组的全部操作（绝大部分），但说实话已经够用了，即使你当前的需求，某一个函数不能解决，那么也能多个函数组合来解决。比如我们想要计算两个数组中相同位置的元素的差，那么就可以这么做：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 一个函数即可解决</span></span><br><span class="line"><span class="keyword">SELECT</span> arrayMap(x, y <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">-</span> y, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─arrayMap(lambda(tuple(x, y), minus(x, y)), [1, 2, 3], [3, 2, 1])─┐</span></span><br><span class="line"><span class="comment">│ [-2,0,2]                                                         │</span></span><br><span class="line"><span class="comment">└──────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>再比如，计算数组中每个元素减去上一个元素的值，由于第一个元素上面没有值，那么设为空：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 我们只需要选择 arr 的前 N - 1 个元素，然后再在头部插入一个 Null，[Null, 11, 22, 33, 44, 55]</span></span><br><span class="line"><span class="comment">-- 最后让 arr 和它的对应元素依次相减即可</span></span><br><span class="line"><span class="keyword">WITH</span> [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>, <span class="number">66</span>] <span class="keyword">AS</span> arr</span><br><span class="line"><span class="keyword">SELECT</span> arrayMap(</span><br><span class="line">    x, y <span class="operator">-</span><span class="operator">&gt;</span> x <span class="operator">-</span> y, </span><br><span class="line">    arr, </span><br><span class="line">    arrayPushFront(arraySlice(arr, <span class="number">1</span>, length(arr) <span class="operator">-</span> <span class="number">1</span>), <span class="keyword">Null</span>)</span><br><span class="line">) v;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">┌─v─────────────────────┐</span></span><br><span class="line"><span class="comment">│ [NULL,11,11,11,11,11] │</span></span><br><span class="line"><span class="comment">└───────────────────────┘</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>显然即使是复杂的需求，也可以通过多个函数组合完成，怎么样，是不是有点酷呢？ClickHouse 内建了很多的函数，这些函数给我们一种仿佛在用编程语言写代码的感觉。</strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://hesay.cn">wenwen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://hesay.cn/2023/04/11/ClickHouse%20%E6%95%B0%E7%BB%84%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD(%E5%8D%81)/">https://hesay.cn/2023/04/11/ClickHouse%20%E6%95%B0%E7%BB%84%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD(%E5%8D%81)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://hesay.cn" target="_blank">热心市民温温</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ClickHouse/">ClickHouse</a></div><div class="post_share"><div class="social-share" data-image="/img/favicon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/11/ClickHouse%20%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0(%E5%8D%81%E4%B8%89)/" title="ClickHouse 日期时间的相关操作函数(十三)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ClickHouse 日期时间的相关操作函数(十三)</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/11/ClickHouse%20%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E4%BB%A5%E5%8F%8A%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5(%E5%8D%81%E5%85%AD)/" title="ClickHouse 的执行计划以及优化策略(十六)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ClickHouse 的执行计划以及优化策略(十六)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/04/11/ClickHouse%20%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0(%E5%8D%81%E4%B8%80)/" title="ClickHouse 中的常用聚合函数(十一)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-11</div><div class="title">ClickHouse 中的常用聚合函数(十一)</div></div></a></div><div><a href="/2023/04/11/ClickHouse%20%E4%B8%AD%E5%85%B6%E5%AE%83%E5%B8%B8%E8%A7%81%E7%9A%84%E8%A1%A8%E5%BC%95%E6%93%8E(%E5%85%AB)/" title="ClickHouse 中其它常见的表引擎(八)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-11</div><div class="title">ClickHouse 中其它常见的表引擎(八)</div></div></a></div><div><a href="/2023/04/11/ClickHouse%20%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E4%BB%A5%E5%8F%8A%E5%90%84%E7%A7%8D%E5%AD%90%E5%8F%A5(%E4%B9%9D)/" title="ClickHouse 中的数据查询以及各种子句(九)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-11</div><div class="title">ClickHouse 中的数据查询以及各种子句(九)</div></div></a></div><div><a href="/2023/04/11/ClickHouse%20%E4%B9%8B%20MergeTree%20%E5%AE%B6%E6%97%8F%E4%B8%AD%E7%9A%84%E5%85%B6%E5%AE%83%E8%A1%A8%E5%BC%95%E6%93%8E(%E4%B8%83)/" title="ClickHouse 之 MergeTree 家族中的其它表引擎(七)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-11</div><div class="title">ClickHouse 之 MergeTree 家族中的其它表引擎(七)</div></div></a></div><div><a href="/2023/04/11/ClickHouse%20%E5%85%B6%E5%AE%83%E7%9A%84%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0%20(%E5%8D%81%E4%BA%94)/" title="ClickHouse 其它的一些操作函数 (十五)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-11</div><div class="title">ClickHouse 其它的一些操作函数 (十五)</div></div></a></div><div><a href="/2023/04/11/ClickHouse%20%E4%B8%AD%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E8%A1%A8%E5%BC%95%E6%93%8E%EF%BC%9AMergeTree%20%E7%9A%84%E6%B7%B1%E5%BA%A6%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90(%E5%85%AD)/" title="ClickHouse 中最重要的表引擎：MergeTree 的深度原理解析(六)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-11</div><div class="title">ClickHouse 中最重要的表引擎：MergeTree 的深度原理解析(六)</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">wenwen</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wenlinshan"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">码海无涯。。。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ClickHouse-%E6%95%B0%E7%BB%84%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD"><span class="toc-number">1.</span> <span class="toc-text">ClickHouse 数组的相关操作函数，一网打尽</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A5%94%E5%AD%90"><span class="toc-number">1.0.1.</span> <span class="toc-text">楔子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.0.2.</span> <span class="toc-text">小结</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/25/spring%E4%B8%AD%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%83%85%E5%86%B5%E4%B8%8B%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E4%BA%8B%E5%8A%A1/" title="spring中多线程情况下如何保证事务">spring中多线程情况下如何保证事务</a><time datetime="2023-07-25T07:34:45.332Z" title="发表于 2023-07-25 15:34:45">2023-07-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/11/ClickHouse%20%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0(%E5%8D%81%E4%B8%80)/" title="ClickHouse 中的常用聚合函数(十一)">ClickHouse 中的常用聚合函数(十一)</a><time datetime="2023-04-11T09:04:31.000Z" title="发表于 2023-04-11 17:04:31">2023-04-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/11/ClickHouse%20%E4%B8%AD%E5%85%B6%E5%AE%83%E5%B8%B8%E8%A7%81%E7%9A%84%E8%A1%A8%E5%BC%95%E6%93%8E(%E5%85%AB)/" title="ClickHouse 中其它常见的表引擎(八)">ClickHouse 中其它常见的表引擎(八)</a><time datetime="2023-04-11T09:04:31.000Z" title="发表于 2023-04-11 17:04:31">2023-04-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/11/ClickHouse%20%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E4%BB%A5%E5%8F%8A%E5%90%84%E7%A7%8D%E5%AD%90%E5%8F%A5(%E4%B9%9D)/" title="ClickHouse 中的数据查询以及各种子句(九)">ClickHouse 中的数据查询以及各种子句(九)</a><time datetime="2023-04-11T09:04:31.000Z" title="发表于 2023-04-11 17:04:31">2023-04-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/11/ClickHouse%20%E4%B9%8B%20MergeTree%20%E5%AE%B6%E6%97%8F%E4%B8%AD%E7%9A%84%E5%85%B6%E5%AE%83%E8%A1%A8%E5%BC%95%E6%93%8E(%E4%B8%83)/" title="ClickHouse 之 MergeTree 家族中的其它表引擎(七)">ClickHouse 之 MergeTree 家族中的其它表引擎(七)</a><time datetime="2023-04-11T09:04:31.000Z" title="发表于 2023-04-11 17:04:31">2023-04-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By wenwen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>